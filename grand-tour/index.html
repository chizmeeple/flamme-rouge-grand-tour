<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Flamme Rouge Grand Tour</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap");
      body {
        font-family: "Inter", sans-serif;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useCallback } = React;

      // Main App Component
      function App() {
        // State management
        const [loading, setLoading] = useState(true);
        const [view, setView] = useState("setup");
        const [teams, setTeams] = useState([]);
        const [totalStages, setTotalStages] = useState(3);
        const [currentStage, setCurrentStage] = useState(1);
        const [finishedRiders, setFinishedRiders] = useState([]);
        const [showModal, setShowModal] = useState(false);
        const [modalRider, setModalRider] = useState(null);
        const [modalTime, setModalTime] = useState({ seconds: 0 });
        const [modalTokens, setModalTokens] = useState({
          sprint: 0,
          mountain: 0,
        });
        const [error, setError] = useState(null);
        const [rankings, setRankings] = useState(null);
        const [editingTeamId, setEditingTeamId] = useState(null);

        // Load data from localStorage on initial render
        useEffect(() => {
          try {
            const savedData = JSON.parse(
              localStorage.getItem("flammeRougeTour")
            );
            if (savedData) {
              setTeams(savedData.teams);
              setTotalStages(savedData.totalStages);
              setCurrentStage(savedData.currentStage);
              setFinishedRiders(savedData.finishedRiders);
              setView(savedData.view);
              setRankings(savedData.rankings);
              setLoading(false); // Set loading to false only after all data is loaded
            } else {
              // Initialize default state if no data is found
              setTeams([
                {
                  id: "red",
                  name: "Red Team",
                  originalName: "Red Team",
                  active: true,
                  history: [],
                },
                {
                  id: "blue",
                  name: "Blue Team",
                  originalName: "Blue Team",
                  active: true,
                  history: [],
                },
                {
                  id: "green",
                  name: "Green Team",
                  originalName: "Green Team",
                  active: true,
                  history: [],
                },
                {
                  id: "black",
                  name: "Black Team",
                  originalName: "Black Team",
                  active: true,
                  history: [],
                },
                {
                  id: "white",
                  name: "White Team",
                  originalName: "White Team",
                  active: true,
                  history: [],
                },
                {
                  id: "pink",
                  name: "Pink Team",
                  originalName: "Pink Team",
                  active: true,
                  history: [],
                },
              ]);
              setTotalStages(3);
              setCurrentStage(1);
              setFinishedRiders([]);
              setView("setup");
              setRankings(null);
              setLoading(false); // Set loading to false for fresh start
            }
          } catch (e) {
            console.error("Failed to load data from localStorage", e);
            setError("Failed to load tour data. Please try again.");
            setLoading(false);
          }
        }, []);

        // Save data to localStorage whenever state changes
        useEffect(() => {
          if (!loading) {
            const dataToSave = {
              teams,
              totalStages,
              currentStage,
              finishedRiders,
              view,
              rankings,
            };
            localStorage.setItem("flammeRougeTour", JSON.stringify(dataToSave));
          }
        }, [
          loading,
          teams,
          totalStages,
          currentStage,
          finishedRiders,
          view,
          rankings,
        ]);

        // Helper function to get team color classes
        const getTeamColorClasses = (originalName) => {
          switch (originalName) {
            case "Red Team":
              return {
                bg: "bg-red-600",
                text: "text-white",
                hover: "hover:bg-red-700",
              };
            case "Blue Team":
              return {
                bg: "bg-blue-600",
                text: "text-white",
                hover: "hover:bg-blue-700",
              };
            case "Green Team":
              return {
                bg: "bg-green-600",
                text: "text-white",
                hover: "hover:bg-green-700",
              };
            case "Black Team":
              return {
                bg: "bg-gray-800",
                text: "text-white",
                hover: "hover:bg-gray-900",
              };
            case "White Team":
              return {
                bg: "bg-gray-200",
                text: "text-gray-900",
                hover: "hover:bg-gray-300",
              };
            case "Pink Team":
              return {
                bg: "bg-pink-600",
                text: "text-white",
                hover: "hover:bg-pink-700",
              };
            default:
              return {
                bg: "bg-gray-500",
                text: "text-white",
                hover: "hover:bg-gray-600",
              };
          }
        };

        // Logic for the Setup view
        const toggleTeam = (teamId) => {
          setTeams((prevTeams) =>
            prevTeams.map((team) =>
              team.id === teamId ? { ...team, active: !team.active } : team
            )
          );
        };

        const handleTeamNameChange = (e, teamId) => {
          const newName = e.target.value;
          setTeams((prevTeams) =>
            prevTeams.map((team) =>
              team.id === teamId ? { ...team, name: newName } : team
            )
          );
        };

        const handleSaveName = () => {
          setEditingTeamId(null);
        };

        const handleStartTour = () => {
          const activeTeams = teams.filter((t) => t.active);
          if (activeTeams.length === 0) {
            setError("Please select at least one team to start the tour.");
            return;
          }
          const initialTeams = activeTeams.map((team) => ({
            ...team,
            history: [],
          }));

          setTeams(initialTeams);
          setCurrentStage(1);
          setFinishedRiders([]);
          setView("stage");
          setError(null);
        };

        // Logic for the Stage view
        const openModal = (teamName, riderType) => {
          setModalRider({ teamName, riderType });
          setShowModal(true);
        };

        const closeModal = () => {
          setShowModal(false);
          setModalRider(null);
          setModalTime({ seconds: 0 });
          setModalTokens({ sprint: 0, mountain: 0 });
        };

        const handleSubmitFinish = () => {
          if (!modalRider) return;

          const { teamName, riderType } = modalRider;
          const newFinishedRider = {
            teamName,
            riderType,
            time: modalTime.seconds,
            podium: 0, // Podium points will be calculated automatically
            sprint: modalTokens.sprint,
            mountain: modalTokens.mountain,
          };

          setFinishedRiders((prev) => [...prev, newFinishedRider]);
          closeModal();
        };

        const handleNextStage = () => {
          setLoading(true);

          // Sort finished riders to determine podium positions
          const sortedFinishedRiders = [...finishedRiders].sort(
            (a, b) => a.time - b.time
          );

          // Assign podium points based on finish order
          const updatedFinishedRiders = sortedFinishedRiders.map(
            (rider, index) => {
              let podiumPoints = 0;
              if (index === 0) podiumPoints = 3;
              else if (index === 1) podiumPoints = 2;
              else if (index === 2) podiumPoints = 1;
              return { ...rider, podium: podiumPoints };
            }
          );

          const newTeams = teams.map((team) => {
            const updatedTeam = { ...team };
            const stageResults = {
              rouleur: updatedFinishedRiders.find(
                (r) => r.teamName === team.name && r.riderType === "Rouleur"
              ),
              sprinteur: updatedFinishedRiders.find(
                (r) => r.teamName === team.name && r.riderType === "Sprinteur"
              ),
            };

            updatedTeam.history.push({
              stage: currentStage,
              results: stageResults,
            });
            return updatedTeam;
          });

          const newCurrentStage = currentStage + 1;
          if (newCurrentStage > totalStages) {
            // End of tour, calculate final rankings
            calculateFinalRankings(newTeams);
            setTeams(newTeams);
            setCurrentStage(newCurrentStage);
            setFinishedRiders([]);
            setView("rankings");
          } else {
            // Proceed to next stage
            setTeams(newTeams);
            setCurrentStage(newCurrentStage);
            setFinishedRiders([]);
          }
          setLoading(false);
        };

        const calculateFinalRankings = (tourTeams) => {
          // Helper to calculate total time, podium, sprint, and mountain points
          const calculateTotals = (team) => {
            const totals = { time: 0, podium: 0, sprint: 0, mountain: 0 };
            team.history.forEach((stage) => {
              totals.time +=
                stage.results.rouleur.time + stage.results.sprinteur.time;
              totals.podium +=
                stage.results.rouleur.podium + stage.results.sprinteur.podium;
              totals.sprint +=
                stage.results.rouleur.sprint + stage.results.sprinteur.sprint;
              totals.mountain +=
                stage.results.rouleur.mountain +
                stage.results.sprinteur.mountain;
            });
            return totals;
          };

          // Calculate total scores for each team
          const teamTotals = tourTeams.map((team) => {
            const totals = calculateTotals(team);
            return { ...team, ...totals };
          });

          // Calculate GC, SC, MC based on the rules
          const gcRankings = teamTotals.sort((a, b) => a.time - b.time);
          const scRankings = teamTotals.sort((a, b) => b.sprint - a.sprint);
          const mcRankings = teamTotals.sort((a, b) => b.mountain - a.mountain);

          setRankings({
            gc: gcRankings,
            sc: scRankings,
            mc: mcRankings,
          });
        };

        const handleRestartTour = () => {
          localStorage.removeItem("flammeRougeTour");
          window.location.reload();
        };

        // Helper for displaying time
        const formatTime = (seconds) => {
          const min = Math.floor(seconds / 60);
          const sec = seconds % 60;
          return `${min}:${sec < 10 ? "0" : ""}${sec}`;
        };

        // Render logic for each view
        const renderSetup = () => {
          const inactiveClasses = "bg-gray-800";
          const inactiveTextClasses = "text-gray-100";

          return (
            <div className="flex flex-col items-center p-4">
              <h2 className="text-2xl font-bold mb-6 text-gray-100">
                Set Up Grand Tour
              </h2>
              <div className="w-full max-w-md">
                <h3 className="text-xl font-semibold mb-2 text-gray-300">
                  Select Teams
                </h3>
                <div className="flex flex-col space-y-2 mb-6">
                  {teams.map((team) => {
                    const color = getTeamColorClasses(team.originalName);
                    return (
                      <div
                        key={team.id}
                        className={`flex items-center justify-between p-3 rounded-xl cursor-pointer shadow-sm transition-all duration-200 ${
                          team.active
                            ? `${color.bg} ${color.hover}`
                            : inactiveClasses
                        }`}
                        onClick={() => toggleTeam(team.id)}
                      >
                        <div
                          className="flex items-center space-x-2 w-full"
                          onClick={(e) => e.stopPropagation()}
                        >
                          {editingTeamId === team.id ? (
                            <div className="flex items-center w-full space-x-2">
                              <input
                                type="text"
                                value={team.name}
                                onChange={(e) =>
                                  handleTeamNameChange(e, team.id)
                                }
                                onKeyDown={(e) => {
                                  if (e.key === "Enter") {
                                    handleSaveName();
                                  }
                                }}
                                onFocus={(e) => {
                                  if (team.name === team.originalName) {
                                    e.target.select();
                                  }
                                }}
                                placeholder="Enter team name"
                                autoFocus
                                className="w-full px-3 py-2 rounded-lg text-sm transition-all duration-200 bg-white text-gray-900 placeholder-gray-400"
                              />
                              <button
                                className="px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 transition"
                                onClick={handleSaveName}
                              >
                                Save
                              </button>
                            </div>
                          ) : (
                            <span
                              className={`font-medium flex items-center ${
                                team.active ? color.text : inactiveTextClasses
                              }`}
                            >
                              <span>{team.name}</span>
                              {team.name !== team.originalName && (
                                <span
                                  className={`text-sm ml-2 ${
                                    team.active
                                      ? "text-opacity-80"
                                      : "text-gray-400"
                                  }`}
                                >
                                  ({team.originalName})
                                </span>
                              )}
                              <button
                                className={`transition duration-200 ml-2 ${
                                  team.active
                                    ? `${color.text} hover:text-opacity-60`
                                    : `${inactiveTextClasses} hover:text-gray-500`
                                }`}
                                onClick={() => setEditingTeamId(team.id)}
                              >
                                ✏️
                              </button>
                            </span>
                          )}
                        </div>
                        <div
                          className={`p-1 rounded-full border-2 transition-all duration-200 ${
                            team.active
                              ? "bg-white border-white"
                              : "border-gray-600"
                          }`}
                        >
                          {team.active && "✔"}
                        </div>
                      </div>
                    );
                  })}
                </div>
                <h3 className="text-xl font-semibold mb-2 text-gray-300">
                  Number of Stages
                </h3>
                <div className="flex items-center justify-center space-x-4 mb-6">
                  <button
                    className="p-2 rounded-full bg-gray-700 text-gray-300 hover:bg-gray-600 transition"
                    onClick={() =>
                      setTotalStages((prev) => Math.max(2, prev - 1))
                    }
                  >
                    ▼
                  </button>
                  <span className="text-4xl font-bold text-gray-100">
                    {totalStages}
                  </span>
                  <button
                    className="p-2 rounded-full bg-gray-700 text-gray-300 hover:bg-gray-600 transition"
                    onClick={() =>
                      setTotalStages((prev) => Math.min(21, prev + 1))
                    }
                  >
                    ▲
                  </button>
                </div>
                {error && <p className="text-red-400 text-sm mb-4">{error}</p>}
                <button
                  className="w-full py-4 bg-indigo-600 text-white rounded-xl shadow-lg hover:bg-indigo-700 transition duration-300 flex items-center justify-center space-x-2"
                  onClick={handleStartTour}
                  disabled={loading}
                >
                  <span className="font-bold">START THE TOUR</span>
                </button>
              </div>
            </div>
          );
        };

        const renderRiderAvatar = (teamName, riderType) => {
          const team = teams.find((t) => t.name === teamName);
          if (!team) return null;
          const { bg, text } = getTeamColorClasses(team.originalName);

          return (
            <div className="relative w-10 h-10 rounded-full overflow-hidden bg-gray-700 border-2 border-gray-600 flex items-center justify-center">
              <span className="text-2xl">🚴</span>
              <div
                className={`absolute top-0 left-0 w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold ${bg} ${text} border border-gray-900`}
              >
                {riderType.charAt(0)}
              </div>
            </div>
          );
        };

        const renderStage = () => {
          return (
            <div className="flex flex-col items-center p-4 min-h-screen">
              <div className="w-full max-w-md">
                <div className="flex items-center justify-between mb-6">
                  <button
                    onClick={() => setView("setup")}
                    className="text-gray-500 hover:text-gray-400 transition"
                  >
                    ←
                  </button>
                  <h2 className="text-3xl font-bold text-gray-100">
                    STAGE {currentStage} / {totalStages}
                  </h2>
                  <button
                    onClick={() => setView("rankings")}
                    className="text-gray-500 hover:text-gray-400 transition"
                  >
                    🏆
                  </button>
                </div>
                <div className="bg-gray-800 p-4 rounded-xl shadow-sm mb-6">
                  <h3 className="text-lg font-semibold text-gray-300 mb-2">
                    Riders in Race
                  </h3>
                  <ul className="space-y-2">
                    {teams
                      .flatMap((team) => [
                        {
                          type: "Rouleur",
                          teamName: team.name,
                          originalName: team.originalName,
                        },
                        {
                          type: "Sprinteur",
                          teamName: team.name,
                          originalName: team.originalName,
                        },
                      ])
                      .filter(
                        (rider) =>
                          !finishedRiders.some(
                            (fr) =>
                              fr.teamName === rider.teamName &&
                              fr.riderType === rider.type
                          )
                      )
                      .map((rider, index) => (
                        <li
                          key={`${rider.teamName}-${rider.type}`}
                          className="flex items-center justify-between bg-gray-700 text-gray-100 p-3 rounded-lg shadow-sm"
                        >
                          <div className="flex items-center space-x-4">
                            {renderRiderAvatar(rider.teamName, rider.type)}
                            <span className="font-medium">
                              {rider.teamName}
                              {rider.teamName !== rider.originalName && (
                                <span className="text-gray-400 text-sm">
                                  {" "}
                                  ({rider.originalName})
                                </span>
                              )}{" "}
                              {rider.type}
                            </span>
                          </div>
                          <button
                            className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition duration-300"
                            onClick={() =>
                              openModal(rider.teamName, rider.type)
                            }
                          >
                            FINISH
                          </button>
                        </li>
                      ))}
                  </ul>
                </div>

                {finishedRiders.length > 0 && (
                  <div className="bg-gray-800 p-4 rounded-xl shadow-sm">
                    <h3 className="text-lg font-semibold text-gray-300 mb-2">
                      Finished Riders
                    </h3>
                    <ul className="space-y-2">
                      {finishedRiders
                        .sort((a, b) => a.time - b.time)
                        .map((rider, index) => (
                          <li
                            key={`${rider.teamName}-${rider.riderType}`}
                            className="flex items-center justify-between bg-gray-700 text-gray-100 p-3 rounded-lg shadow-sm"
                          >
                            <div className="flex items-center space-x-4">
                              <span className="mr-2 text-indigo-400 font-bold">
                                #{index + 1}
                              </span>
                              {renderRiderAvatar(
                                rider.teamName,
                                rider.riderType
                              )}
                              <span className="font-medium">
                                {rider.teamName}{" "}
                                {teams.find((t) => t.name === rider.teamName)
                                  ?.name !==
                                  teams.find((t) => t.name === rider.teamName)
                                    ?.originalName && (
                                  <span className="text-gray-400 text-sm">
                                    (
                                    {
                                      teams.find(
                                        (t) => t.name === rider.teamName
                                      )?.originalName
                                    }
                                    )
                                  </span>
                                )}{" "}
                                {rider.riderType}
                              </span>
                            </div>
                            <span className="text-gray-400 text-sm">
                              Time: {formatTime(rider.time)}
                            </span>
                          </li>
                        ))}
                    </ul>
                  </div>
                )}

                {finishedRiders.length === teams.length * 2 && (
                  <button
                    className="mt-6 w-full py-4 bg-indigo-600 text-white rounded-xl shadow-lg hover:bg-indigo-700 transition duration-300 flex items-center justify-center space-x-2"
                    onClick={handleNextStage}
                    disabled={loading}
                  >
                    {loading ? "..." : "→"}
                    <span className="font-bold">NEXT STAGE</span>
                  </button>
                )}
              </div>

              {showModal && (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4">
                  <div className="bg-gray-800 p-6 rounded-xl shadow-2xl w-full max-w-sm">
                    <div className="flex justify-end">
                      <button
                        onClick={closeModal}
                        className="text-gray-400 hover:text-gray-300"
                      >
                        X
                      </button>
                    </div>
                    <h3 className="text-xl font-bold mb-4 text-gray-100">
                      Score Rider
                    </h3>
                    <div className="flex items-center space-x-4 mb-4 justify-center">
                      {renderRiderAvatar(
                        modalRider.teamName,
                        modalRider.riderType
                      )}
                      <p className="text-lg font-medium text-gray-300">
                        {modalRider.teamName} {modalRider.riderType}
                      </p>
                    </div>

                    <div className="space-y-4">
                      <div className="flex items-center justify-between">
                        <label className="font-semibold text-gray-300">
                          Finish Time (s)
                        </label>
                        <input
                          type="number"
                          value={modalTime.seconds}
                          onChange={(e) =>
                            setModalTime({
                              seconds: Math.max(
                                0,
                                parseInt(e.target.value) || 0
                              ),
                            })
                          }
                          className="w-24 px-3 py-2 border rounded-lg text-center bg-gray-700 text-white border-gray-600"
                        />
                      </div>

                      <div className="flex items-center justify-between">
                        <label className="font-semibold text-gray-300">
                          Sprint Points
                        </label>
                        <input
                          type="number"
                          value={modalTokens.sprint}
                          onChange={(e) =>
                            setModalTokens({
                              ...modalTokens,
                              sprint: Math.max(
                                0,
                                parseInt(e.target.value) || 0
                              ),
                            })
                          }
                          className="w-24 px-3 py-2 border rounded-lg text-center bg-gray-700 text-white border-gray-600"
                        />
                      </div>

                      <div className="flex items-center justify-between">
                        <label className="font-semibold text-gray-300">
                          Mountain Points
                        </label>
                        <input
                          type="number"
                          value={modalTokens.mountain}
                          onChange={(e) =>
                            setModalTokens({
                              ...modalTokens,
                              mountain: Math.max(
                                0,
                                parseInt(e.target.value) || 0
                              ),
                            })
                          }
                          className="w-24 px-3 py-2 border rounded-lg text-center bg-gray-700 text-white border-gray-600"
                        />
                      </div>
                    </div>

                    <button
                      className="mt-6 w-full py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition duration-300"
                      onClick={handleSubmitFinish}
                    >
                      Confirm
                    </button>
                  </div>
                </div>
              )}
            </div>
          );
        };

        const renderRankings = () => {
          if (!rankings) {
            return (
              <div className="flex flex-col items-center justify-center min-h-screen bg-gray-900 text-gray-100">
                <h2 className="text-2xl font-bold mb-4 text-gray-100">
                  Final Rankings
                </h2>
                <p className="text-gray-300">Calculating rankings...</p>
                <button
                  onClick={() => setView("stage")}
                  className="mt-4 px-4 py-2 rounded-lg bg-gray-700 text-gray-100 hover:bg-gray-600"
                >
                  Go Back
                </button>
              </div>
            );
          }
          const { gc, sc, mc } = rankings;
          return (
            <div className="flex flex-col items-center p-4 min-h-screen">
              <div className="w-full max-w-md">
                <div className="flex items-center justify-between mb-6">
                  <button
                    onClick={() => setView("stage")}
                    className="text-gray-500 hover:text-gray-400 transition"
                  >
                    ←
                  </button>
                  <h2 className="text-3xl font-bold text-gray-100">
                    Final Rankings
                  </h2>
                  <button
                    onClick={handleRestartTour}
                    className="text-gray-500 hover:text-gray-400 transition"
                  >
                    🔄
                  </button>
                </div>

                <div className="space-y-6">
                  {/* General Classification */}
                  <div className="bg-gray-800 p-4 rounded-xl shadow-sm">
                    <h3 className="text-xl font-bold mb-2 text-gray-300 flex items-center space-x-2">
                      <span>⏱️</span>
                      <span>General Classification (Total Time)</span>
                    </h3>
                    <ul className="space-y-2">
                      {gc.map((team, index) => (
                        <li
                          key={team.id}
                          className="flex items-center justify-between bg-gray-700 p-3 rounded-lg shadow-sm"
                        >
                          <div className="flex items-center space-x-4">
                            <span className="mr-2 text-indigo-400 font-bold">
                              #{index + 1}
                            </span>
                            <div className="flex items-center">
                              {renderRiderAvatar(team.name, "Rouleur")}
                              <span className="font-medium ml-4 text-gray-100">
                                {team.name}{" "}
                                {team.name !== team.originalName && (
                                  <span className="text-gray-400 text-sm">
                                    ({team.originalName})
                                  </span>
                                )}
                              </span>
                            </div>
                          </div>
                          <span className="text-gray-400 text-sm">
                            {formatTime(team.time)}
                          </span>
                        </li>
                      ))}
                    </ul>
                  </div>

                  {/* Sprint Classification */}
                  <div className="bg-gray-800 p-4 rounded-xl shadow-sm">
                    <h3 className="text-xl font-bold mb-2 text-gray-300 flex items-center space-x-2">
                      <span>🏁</span>
                      <span>Sprint Classification</span>
                    </h3>
                    <ul className="space-y-2">
                      {sc.map((team, index) => (
                        <li
                          key={team.id}
                          className="flex items-center justify-between bg-gray-700 p-3 rounded-lg shadow-sm"
                        >
                          <div className="flex items-center space-x-4">
                            <span className="mr-2 text-indigo-400 font-bold">
                              #{index + 1}
                            </span>
                            <div className="flex items-center">
                              {renderRiderAvatar(team.name, "Sprinteur")}
                              <span className="font-medium ml-4 text-gray-100">
                                {team.name}{" "}
                                {team.name !== team.originalName && (
                                  <span className="text-gray-400 text-sm">
                                    ({team.originalName})
                                  </span>
                                )}
                              </span>
                            </div>
                          </div>
                          <span className="text-gray-400 text-sm">
                            {team.sprint} pts
                          </span>
                        </li>
                      ))}
                    </ul>
                  </div>

                  {/* Mountain Classification */}
                  <div className="bg-gray-800 p-4 rounded-xl shadow-sm">
                    <h3 className="text-xl font-bold mb-2 text-gray-300 flex items-center space-x-2">
                      <span>🥇</span>
                      <span>Mountain Classification</span>
                    </h3>
                    <ul className="space-y-2">
                      {mc.map((team, index) => (
                        <li
                          key={team.id}
                          className="flex items-center justify-between bg-gray-700 p-3 rounded-lg shadow-sm"
                        >
                          <div className="flex items-center space-x-4">
                            <span className="mr-2 text-indigo-400 font-bold">
                              #{index + 1}
                            </span>
                            <div className="flex items-center">
                              {renderRiderAvatar(team.name, "Rouleur")}
                              <span className="font-medium ml-4 text-gray-100">
                                {team.name}{" "}
                                {team.name !== team.originalName && (
                                  <span className="text-gray-400 text-sm">
                                    ({team.originalName})
                                  </span>
                                )}
                              </span>
                            </div>
                          </div>
                          <span className="text-gray-400 text-sm">
                            {team.mountain} pts
                          </span>
                        </li>
                      ))}
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        // Main render logic
        if (loading) {
          return (
            <div className="flex flex-col items-center justify-center min-h-screen bg-gray-900 text-gray-100">
              <p className="text-lg">Loading Tour...</p>
            </div>
          );
        }

        if (error) {
          return (
            <div className="flex flex-col items-center justify-center min-h-screen bg-gray-900 text-red-400 p-4 text-center">
              <p className="font-semibold text-lg">{error}</p>
              <button
                onClick={() => window.location.reload()}
                className="mt-4 px-4 py-2 rounded-lg bg-red-800 text-red-100"
              >
                Reload
              </button>
            </div>
          );
        }

        const currentView = {
          setup: renderSetup(),
          stage: renderStage(),
          rankings: renderRankings(),
        }[view];

        return (
          <div className="min-h-screen bg-gray-900 font-sans antialiased text-gray-100">
            {currentView}
          </div>
        );
      }

      // Use createRoot for React 18 compatibility
      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
